<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE stax SYSTEM "../../../shared/stax.dtd">
<!--
 ! CDDL HEADER START
 !
 ! The contents of this file are subject to the terms of the
 ! Common Development and Distribution License, Version 1.0 only
 ! (the "License").  You may not use this file except in compliance
 ! with the License.
 !
 ! You can obtain a copy of the license at
 ! trunk/opends/resource/legal-notices/OpenDS.LICENSE
 ! or https://OpenDS.dev.java.net/OpenDS.LICENSE.
 ! See the License for the specific language governing permissions
 ! and limitations under the License.
 !
 ! When distributing Covered Code, include this CDDL HEADER in each
 ! file and include the License file at
 ! trunk/opends/resource/legal-notices/OpenDS.LICENSE.  If applicable,
 ! add the following below this CDDL HEADER, with the fields enclosed
 ! by brackets "[]" replaced with your own identifying information:
 !      Portions Copyright [yyyy] [name of copyright owner]
 !
 ! CDDL HEADER END
 !
 !      Portions Copyright 2006-2007 Sun Microsystems, Inc.
 ! -->
<stax>
  <function name="configureSSL">
    <function-prolog>
      This function makes the configuration changes for SSL
    </function-prolog>
    <function-map-args>
     <function-arg-def name="location" type="optional" default="'%s' % STAF_REMOTE_HOSTNAME">
        <function-arg-description>
          Location of target host
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>
      <function-arg-def name="dsPath" type="optional" default="'%s/%s' % (DIRECTORY_INSTANCE_DIR,OPENDSNAME)">
        <function-arg-description>
          Pathname to installation root
        </function-arg-description>
        <function-arg-property name="type" value="filepath"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceHost" type="optional">
        <function-arg-description>
          Directory server hostname or IP address
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>      
      <function-arg-def name="dsInstancePort" type="optional">
        <function-arg-description>
          Directory server port number
        </function-arg-description>
        <function-arg-property name="type" value="Port number"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceDn" type="optional">
        <function-arg-description>
          Bind DN
        </function-arg-description>
        <function-arg-property name="type" value="DN"/>
      </function-arg-def> 
      <function-arg-def name="dsInstancePswd" type="optional">
        <function-arg-description>
          Bind password
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="keystoreType" type="required">
        <function-arg-description>
          Keystore type
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="extraParams" type="optional">
        <function-arg-description>
          Optional extra parameters for specific test cases
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>                
    </function-map-args>
    <sequence>
    
      <!-- Local variables -->
      <script>
        mylocation=location
        myhost=dsInstanceHost
        myport=dsInstancePort
        mydn=dsInstanceDn
        mypswd=dsInstancePswd
      </script>
          
      <!--- Enable Key Manager Provider -->
      <message>
       'Enabling Key Manager Provider'
      </message>
      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/setup/enable_key_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>
      <call function="'checkRC'">
      { 'returncode' : RC ,
        'result'     : STAXResult }
      </call>

      <!--- Enable Trust Manager Provider -->
      <message>
         'Enabling Trust Manager Provider'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/setup/enable_trust_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
        { 'returncode' : RC ,
          'result'     : STAXResult }
      </call>

      <!--- Enable LDAPS Connection Handler -->
      <message>
       'Enabling LDAPS Connection Handler - Port number'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/ldaps_port.ldif' % (logsRemoteDataDir) }
      </call>

      <call function="'checkRC'">
        { 'returncode' : RC ,
          'result'     : STAXResult }
      </call>

      <message>
       'Enabling LDAPS Connection Handler - Keystore type'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/setup/enable_ldaps_conn_handler.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
        { 'returncode' : RC ,
          'result'     : STAXResult }
      </call>
    </sequence>
  </function>

  <function name="configureTLS">
    <function-prolog>
      This function makes the configuration changes for startTLS
    </function-prolog>
    <function-map-args>
      <function-arg-def name="location" type="optional" default="'%s' % STAF_REMOTE_HOSTNAME">
        <function-arg-description>
            Location of target host
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>
      <function-arg-def name="dsPath" type="optional" default="'%s/%s' % (DIRECTORY_INSTANCE_DIR,OPENDSNAME)">
        <function-arg-description>
          Pathname to installation root
        </function-arg-description>
        <function-arg-property name="type" value="filepath"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceHost" type="optional">
        <function-arg-description>
          Directory server hostname or IP address
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>      
      <function-arg-def name="dsInstancePort" type="optional">
        <function-arg-description>
          Directory server port number
        </function-arg-description>
        <function-arg-property name="type" value="Port number"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceDn" type="optional">
        <function-arg-description>
          Bind DN
        </function-arg-description>
        <function-arg-property name="type" value="DN"/>
      </function-arg-def> 
      <function-arg-def name="dsInstancePswd" type="optional">
        <function-arg-description>
          Bind password
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="keystoreType" type="required">
        <function-arg-description>
          Keystore type
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="extraParams" type="optional">
        <function-arg-description>
          Optional extra parameters for specific test cases
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
    </function-map-args>
      <sequence>
      
      <!-- Local variables -->
      <script>
        mylocation=location
        myhost=dsInstanceHost
        myport=dsInstancePort
        mydn=dsInstanceDn
        mypswd=dsInstancePswd
      </script>
      
      <!--- Enable Key Manager Provider -->
      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/setup/enable_key_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>
      <call function="'checkRC'">
      { 'returncode' : RC ,
        'result'     : STAXResult }
      </call>

      <!--- Enable Trust Manager Provider -->
      <message>
         'Enabling Trust Manager Provider'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/setup/enable_trust_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
        { 'returncode' : RC ,
          'result'     : STAXResult }
      </call>

        <!--- Enable StartTLS -->
        <message>
         'Enabling StartTLS'
        </message>

      <call function="'addEntry'">
        { 'location'        : mylocation ,
          'dsInstanceHost'  : myhost ,
          'dsInstancePort'  : myport ,
          'dsInstanceDn'    : mydn ,
          'dsInstancePswd'  : mypswd ,
          'entryToBeAdded'  : '%s/security/%s/setup/enable_startTLS.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
        { 'returncode' : RC ,
          'result'     : STAXResult }
      </call>
    </sequence>
  </function>

  <function name="unconfigureSSL">
    <function-prolog>
      This function reverses the configuration changes for SSL
    </function-prolog>
    <function-map-args>
      <function-arg-def name="location" type="optional" default="'%s' % STAF_REMOTE_HOSTNAME">
        <function-arg-description>
            Location of target host
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>
      <function-arg-def name="dsPath" type="optional" default="'%s/%s' % (DIRECTORY_INSTANCE_DIR,OPENDSNAME)">
        <function-arg-description>
          Pathname to installation root
        </function-arg-description>
        <function-arg-property name="type" value="filepath"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceHost" type="optional">
        <function-arg-description>
          Directory server hostname or IP address
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>      
      <function-arg-def name="dsInstancePort" type="optional">
        <function-arg-description>
          Directory server port number
        </function-arg-description>
        <function-arg-property name="type" value="Port number"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceDn" type="optional">
        <function-arg-description>
          Bind DN
        </function-arg-description>
        <function-arg-property name="type" value="DN"/>
      </function-arg-def> 
      <function-arg-def name="dsInstancePswd" type="optional">
        <function-arg-description>
          Bind password
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="keystoreType" type="required">
        <function-arg-description>
          Keystore type
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="extraParams" type="optional">
        <function-arg-description>
          Optional extra parameters for specific test cases
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
    </function-map-args>
    <sequence>
      <!-- Local variables -->
      <script>
        mylocation=location
        myhost=dsInstanceHost
        myport=dsInstancePort
        mydn=dsInstanceDn
        mypswd=dsInstancePswd
      </script>
          
      <!--- Disable LDAPS Connection Handler -->
      <message>
         'Disabling LDAPS Connection Handler'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/teardown/disable_ldaps_conn_handler.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
          { 'returncode' : RC ,
            'result'     : STAXResult }
      </call>

      <!--- Disable SSL Trust Manager Provider -->
      <message>
         'Disabling SSL Trust Manager Provider'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/teardown/disable_trust_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
          { 'returncode' : RC ,
            'result'     : STAXResult }
      </call>

      <!--- Disable Key Manager Provider -->
      <message>
         'Disabling Key Manager Provider'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/teardown/disable_key_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
          { 'returncode' : RC ,
            'result'     : STAXResult }
      </call>
    </sequence>
  </function>

  <function name="unconfigureTLS">
    <function-prolog>
      This function reverses the configuration changes for startTLS
    </function-prolog>
    <function-map-args>
      <function-arg-def name="location" type="optional" default="'%s' % STAF_REMOTE_HOSTNAME">
        <function-arg-description>
            Location of target host
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>
      <function-arg-def name="dsPath" type="optional" default="'%s/%s' % (DIRECTORY_INSTANCE_DIR,OPENDSNAME)">
        <function-arg-description>
          Pathname to installation root
        </function-arg-description>
        <function-arg-property name="type" value="filepath"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceHost" type="optional">
        <function-arg-description>
          Directory server hostname or IP address
        </function-arg-description>
        <function-arg-property name="type" value="hostname"/>
      </function-arg-def>      
      <function-arg-def name="dsInstancePort" type="optional">
        <function-arg-description>
          Directory server port number
        </function-arg-description>
        <function-arg-property name="type" value="Port number"/>
      </function-arg-def>
      <function-arg-def name="dsInstanceDn" type="optional">
        <function-arg-description>
          Bind DN
        </function-arg-description>
        <function-arg-property name="type" value="DN"/>
      </function-arg-def> 
      <function-arg-def name="dsInstancePswd" type="optional">
        <function-arg-description>
          Bind password
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="keystoreType" type="required">
        <function-arg-description>
          Keystore type
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
      <function-arg-def name="extraParams" type="optional">
        <function-arg-description>
          Optional extra parameters for specific test cases
        </function-arg-description>
        <function-arg-property name="type" value="string"/>
      </function-arg-def>
    </function-map-args>
    <sequence>
    
      <!-- Local variables -->
      <script>
        mylocation=location
        myhost=dsInstanceHost
        myport=dsInstancePort
        mydn=dsInstanceDn
        mypswd=dsInstancePswd
      </script>
          
      <!--- Disable StartTLS -->
      <message>
       'Disabling StartTLS'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/teardown/disable_startTLS.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
          { 'returncode' : RC ,
            'result'     : STAXResult }
      </call>

      <!--- Disable SSL Trust Manager Provider -->
      <message>
         'Disabling SSL Trust Manager Provider'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/teardown/disable_trust_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
          { 'returncode' : RC ,
            'result'     : STAXResult }
      </call>

      <!--- Disable Key Manager Provider -->
      <message>
         'Disabling Key Manager Provider'
      </message>

      <call function="'modifyEntry'">
        { 'location'          : mylocation ,
          'dsInstanceHost'    : myhost ,
          'dsInstancePort'    : myport ,
          'dsInstanceDn'      : mydn ,
          'dsInstancePswd'    : mypswd ,
          'entryToBeModified' : '%s/security/%s/teardown/disable_key_mgr_provider.ldif' % (logsRemoteDataDir,keystoreType) }
      </call>

      <call function="'checkRC'">
          { 'returncode' : RC ,
            'result'     : STAXResult }
      </call>
      </sequence>
    </function>
</stax>
